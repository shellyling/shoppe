!function(){"use strict";class e{constructor(i){this.reading_time_interval=10,this.reading_time_max=!1,this.sn_cookies={sn_uid:"sn_uid"},this.sn_domain="https://sn.bnextmedia.com.tw",this.sn_rec_domain="https://sn-rec.bnextmedia.com.tw",this.salmon_conf=i,"v"in this.salmon_conf||(this.salmon_conf.v=1),"m_id"in this.salmon_conf||(this.salmon_conf.m_id=""),"is_sent_reading_time"in this.salmon_conf||(this.salmon_conf.is_sent_reading_time=!0),this.sn_uid="",this.jsc=(new Date).getTime(),this.pv_id="",this.reading_intervals=0,this.reading_timer=!1,this.reading_scrollY=-100,e.log("initial!")}init_reading_time(){!1!==this.reading_timer&&clearInterval(this.reading_timer),this.reading_intervals=0,this.reading_scrollY=-100,this.reading_timer=setInterval((()=>{var e=window.scrollY||document.body.scrollTop||0;this.reading_intervals++,Math.abs(e-this.reading_scrollY)>10&&(this.reading_scrollY=e,this.send_reading_time())}),1e3*this.reading_time_interval)}send_page_view(e="",i="",n=1){e||(e=window.location.href),i||(i=document.referrer);var t={ac:"page_view",url:e,referrer:i,page:n},s=Date.now(),a=this.random();this.pv_id=`${s}.${a}`,this.send_event(t,"ac=page_view"),this.salmon_conf.is_sent_reading_time&&this.init_reading_time()}send_reading_time(){var e=this.reading_intervals*this.reading_time_interval;0!=this.reading_time_max&&e>=this.reading_time_max&&(e=this.reading_time_max,clearInterval(this.reading_timer));var i={ac:"reading_time",reading_time:e};this.send_event(i,"ac=reading_time")}send_reading_pct(i){if((i=Math.round(i))>=0&&i<=100){var n={ac:"reading_pct",reading_pct:i};this.send_event(n,"ac=reading_pct")}else e.log("pct is invalid")}send_privacy_agreement(e){e||(e=window.location.host);var i={ac:"agree_privacy",site:e};this.send_event(i,"ac=agree_privacy")}send_universal_event(i="",n="",t="",s=0){if(i)if("number"==typeof s){var a={ac:"universal",category:i,action:n,label:t,value:s};this.send_event(a,"ac=universal")}else e.log("value is invalid");else e.log("category is invalid")}send_event(i,n){if(this.sn_uid)e.log(`use retrieved sn_uid: ${this.sn_uid}`),this.send(i,n);else{var t=this.retrieve_cookie(this.sn_cookies.sn_uid);t?(this.sn_uid=t,e.log(`use retrieved sn_uid: ${this.sn_uid}`),this.send(i,n)):this.jsp({url:this.sn_domain+"/cm/gc",data:{},callback:t=>{(t=JSON.parse(t)).uid&&(this.sn_uid=t.uid,e.log(`use requested sn_uid: ${this.sn_uid}`),this.create_cookie(this.sn_cookies.sn_uid,this.sn_uid,2592e3,"/",!1,!0),this.send(i,n))}},"jsoncallback")}}send(i={},n){n||(n=""),i.sn_uid=this.sn_uid,i.sn_channel_domain=window.top.location.host,i.v=this.salmon_conf.v,i.m_id=this.salmon_conf.m_id,i.pv_id=this.pv_id;var t=document.createElement("IMG"),s="";if(n.length>0&&(s="&"+n),i.ac){i.time=i.time||Date.now(),i.random=i.random||this.random();var a=JSON.stringify(i),o=btoa(encodeURI(a)),d=this.salmon_conf.is_remote_log?this.sn_rec_domain:window.location.origin;d+="/salmon.png?msg="+o+s,t.src=d,t.id="tc-img",t.style.cssText="display: none;",document.getElementsByTagName("body")[0].appendChild(t),"universal"==i.ac?e.log(`sent ${i.ac}.${i.category} event`):e.log(`sent ${i.ac} event`)}else e.log("ac param not found")}retrieve_cookie(i){var n=null,t=i+"=";for(var s of document.cookie.split(";"))if(0==(s=s.trim()).indexOf(t)){n=s.substring(t.length,s.length);break}return e.log(`retrieved cookie ${i}: ${n}`),n}create_cookie(i,n,t,s,a,o){var d=new Date(Date.now()+1e3*t).toUTCString(),r=i+"="+encodeURIComponent(n)+(d?"; expires="+d:"")+(s?"; path="+s:"")+(a?"; domain="+a:"")+(o?"; SameSite=none; secure":"");document.cookie=r,e.log(`create cookie ${i}: ${n}`)}delete_cookie(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/"}jsp(e,i){if(e.url&&i){var n=e.data||{};n[i]="XD"+this.jsc++,window[n[i]]=function(i){e.callback(i)};var t=e.url+"?"+this.jsp_params(n);this.jsp_get_script(t,(function(){window[n[i]]=void 0;try{delete window[n[i]]}catch(e){}}))}}jsp_params(e){var i=[];for(var n in e){var t=encodeURIComponent(n)+"="+encodeURIComponent(e[n]);i.push(t.replace("/%20/g","+"))}return i.join("&")}jsp_get_script(e,i){var n=document.createElement("script");n.type="text/javascript",n.src=e,n.onload=n.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(this.onload=this.onreadystatechange=null,document.getElementsByTagName("head")[0].removeChild(this),i())},document.getElementsByTagName("head")[0].appendChild(n)}static log(e){console.log(`[Sn Log] ${e}`)}random(e=3){return Math.floor(Math.random()*10**e+1)}}window.salmon_conf=window.salmon_conf||{is_sent_pv_ready:!0,is_sent_reading_time:!0,is_remote_log:!1,m_id:""},void 0===window.sn&&(window.sn=new e(window.salmon_conf)),"is_sent_pv_ready"in window.salmon_conf&&0==window.salmon_conf.is_sent_pv_ready||("interactive"==document.readyState?window.sn.send_page_view():document.addEventListener("DOMContentLoaded",(function(i){e.log("page ready!"),window.sn.send_page_view()}))),window.sent_page_view=(e,i,n)=>{window.sn.send_page_view(e,i,n)},window.sent_reading_pct=e=>{window.sn.send_reading_pct(e)},window.sent_universal_event=(e,i,n,t)=>{window.sn.send_universal_event(e,i,n,t)},window.snj_sent_privacy_agreement=e=>{window.sn.send_privacy_agreement(e)},window.snj_send_info=(e,i="")=>{window.sn.send_event(e,i)}}();
